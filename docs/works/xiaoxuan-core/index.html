<!doctype html>

<html lang="en">

<head>
  <title>XiaoXuan Core - Hemashushu&#39;s Homepage</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Hemashushu&#39;s homepage, sharing some computer technology, programming skills, learning notes, some home-brew softwares and hardwares" />
<meta name="author" content="hemashushu" /><meta property="og:title" content="XiaoXuan Core" />
<meta property="og:description" content="The XiaoXuan Core Programming Language is used to build powerful user-space system programs with extremely fast startup speed and small footprint, it can directly call syscall and interoperate with C shared libraries. Single-file, statically linked runtime make applications highly portable.
Motivation Availability and portability Traditional system programs, as well as command-line utilities, can be difficult for ordinary users to set up and run if they are not maintained by a distribution and have not been updated for a while, this is because:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hemashushu.github.io/works/xiaoxuan-core/" /><meta property="article:section" content="works" />
<meta property="article:published_time" content="2023-12-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-25T00:00:00+00:00" />


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="XiaoXuan Core"/>
<meta name="twitter:description" content="The XiaoXuan Core Programming Language is used to build powerful user-space system programs with extremely fast startup speed and small footprint, it can directly call syscall and interoperate with C shared libraries. Single-file, statically linked runtime make applications highly portable.
Motivation Availability and portability Traditional system programs, as well as command-line utilities, can be difficult for ordinary users to set up and run if they are not maintained by a distribution and have not been updated for a while, this is because:"/>

<meta name="generator" content="Hugo 0.121.2">
    
    <script src="/js/mathjax-config.js" defer></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://hemashushu.github.io/fontawesome/css/all.min.css" />
  

  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css" /><link rel='stylesheet' href='https://hemashushu.github.io/css/custom.css'></head>

<body>
  <header>
    
    <div id="content">
      <ul id="social-media">
        
                <li>
                <a href="https://github.com/hemashushu" title="GitHub">
                <i class="fab fa-github fa-lg"></i>
                </a>
                </li>
                <li>
                <a href="https://twitter.com/hemashushu" title="Twitter">
                <i class="fab fa-twitter fa-lg"></i>
                </a>
                </li>
                <li>
                <a href="https://www.youtube.com/@hemashushu" title="Youtube">
                <i class="fab fa-youtube fa-lg"></i>
                </a>
                </li>
      </ul>

      
      <h1>
      <a href="/">Hemashushu&rsquo;s Homepage</a>
      </h1>

      
      <p><em>Curiosity, exploration and creation</em></p>
      
    </div>
  </header>
  <div id="container">


    
<nav>
    <ul>
        <li>
            <a href="/" title="Home">Home</a>
        </li>
        
        <li>
            <a class="active" href="/works/">
                <i class="fa-li fa  fa-lg"></i><span>Works</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/posts/">
                <i class="fa-li fa  fa-lg"></i><span>Posts</span>
            </a>
        </li>
        
        <li>
            <a class="" href="/about/">
                <i class="fa-li fa  fa-lg"></i><span>About</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>XiaoXuan Core</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2023-12-25T00:00:00Z">Dec 25, 2023</time>
        </li>
        

        
        <li>
            Categories:
            <em>
                
                    
                    <a href="/categories/xiaoxuan-core">xiaoxuan-core</a>
                
            </em>
        </li>
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/xiaoxuan-core">#xiaoxuan-core</a>
                
                    , 
                    <a href="/tags/xiaoxuan-lang">#xiaoxuan-lang</a>
                
            </em>
        </li>
        

        <li>6 minute read</li>
    </ul>
</aside>

    

    
      

    

    <figure class="wide"><img src="./images/banner.png"/>
</figure>

<p>The <em>XiaoXuan Core Programming Language</em> is used to build powerful user-space system programs with extremely fast startup speed and small footprint, it can directly call <em>syscall</em> and interoperate with C shared libraries. Single-file, statically linked runtime make applications highly portable.</p>
<h2 id="motivation">Motivation</h2>
<h3 id="availability-and-portability">Availability and portability</h3>
<p>Traditional system programs, as well as command-line utilities, can be difficult for ordinary users to set up and run if they are not maintained by a distribution and have not been updated for a while, this is because:</p>
<ul>
<li>
<p>For applications built with compiled languages:</p>
<ul>
<li>May encounter excessive dependencies that require manual compilation during the build process.</li>
<li>Compilation may fail due to changes in shared library version.</li>
</ul>
</li>
<li>
<p>For applications built with script languages:</p>
<ul>
<li>May encounter version incompatibility issues</li>
<li>May encounter dependency version conflict issues</li>
</ul>
</li>
</ul>
<p><em>XiaoXuan Core</em> has learned from these lessons and is designed to ensure that once an application is created and can run, it will continue to run correctly even if it is not maintained and after a long period of time.</p>
<h3 id="ease-of-development-maintaince-and-high-performance">Ease of development, maintaince, and high performance</h3>
<p>The <em>XiaoXuan Core</em> language strikes a good balance between &ldquo;ease of development&rdquo; and &ldquo;high performance&rdquo;. The <em>XiaoXuan Core</em> language has the following features:</p>
<ul>
<li>Data-race-free concurrency model</li>
<li>GC-free automatic memory management</li>
<li>Discards difficult-to-master concepts such as pointers, ownership, borrow checking and lifetimes.</li>
</ul>
<p>These features make it easy for developers to develop safe, stable and high-performance applications.</p>
<h2 id="quick-start">Quick start</h2>
<p>The following code demostrates how to call syscalls and external functions (from shared libraries). The code prints the current working directory.</p>
<blockquote>
<p>The <em>XiaoXuan Core</em> standard library provides simpler ways to get the current working directory or print strings. The code below is written for demostration purposes only. Additionally, the following steps assume a Linux operation system. If you are using other platform or want to try a simpler &ldquo;Hello, World!&rdquo; program, please refer to the <span class="null-link">XiaoXuan Code Documentation</span>.</p>
</blockquote>
<ol>
<li>Create a file named <code>pwd.anc</code> in any directory with the following content:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">config</span><span class="p">(</span><span class="nx">runtime</span><span class="p">,</span> <span class="s2">&#34;1.0&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">external</span> <span class="nx">shared</span> <span class="s2">&#34;libc.so.6&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nx">puts</span><span class="p">(</span><span class="nx">addr</span><span class="o">:</span><span class="kr">long</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">buf_length</span> <span class="o">=</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">std</span><span class="o">::</span><span class="nb">Array</span><span class="o">::&lt;</span><span class="kr">byte</span><span class="o">&gt;::</span><span class="nx">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">buf_length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// invoke syscall
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">syscall</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">syscall</span><span class="o">::</span><span class="nx">number</span><span class="o">::</span><span class="nx">getcwd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">buf</span><span class="p">.</span><span class="nx">raw_addr</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">buf</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// call external function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">puts</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nx">raw_addr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ol start="2">
<li>
<p>Download the <em>XiaoXuan Core</em> launcher <span class="null-link">ancl-1.0.1.x86_64-linux-gnu.tar.gz</span> from the offical website and extract it to the <code>~/.local/bin</code> or <code>/usr/bin</code> directory.</p>
</li>
<li>
<p>Run the following command:</p>
</li>
</ol>
<p><code>$ ancl pwd.anc</code></p>
<p>The launcher will first check the version of the runtime required by the application and then start the corresponding runtime to execute it.</p>
<p>Since this is the first time we are running an <em>XiaoXuan Core</em> application, the launcher will download the runtime from the internet. Then the runtime will compile and cache the application on-the-fly. Finally, you should see the application output a line of text, which is the current working directory.</p>
<h2 id="the-xiaoxuan-core-vm">The XiaoXuan Core VM</h2>
<figure class="wide white"><img src="./images/vm-model.png"
         alt="The XiaoXuan Core VM"/><figcaption>
            <p>The XiaoXuan Core VM</p>
        </figcaption>
</figure>

<p><em>XiaoXuan Runtime</em> is a self-contained, statically linked executable that combines a compiler and a virtual machine (VM) designed specifically for running system programs. It offers serveral key advantages:</p>
<ul>
<li><strong>Fast loading:</strong> The structure of the application&rsquo;s image file and the instruction set architecture (ISA) are specially designed to eliminate the need for parsing and preprocessing by the VM. Instead, the file is simply mapped to memory and the bytecode can be executed directly.</li>
<li><strong>Program security:</strong> The <em>XiaoXuan Core VM</em> uses indexes instead of pointers to locate functions, data, and local variables. The stack is also divided into three separate stack: frame information, local variables, and operands. This effectively prevents memory boundary and overflow issues, reducing program vulnerabilities.</li>
<li><strong>Seamless interoperability with C/C++/Rust shared libraries:</strong> The VM&rsquo;s memory model closely resembles that of the local native machine, allowing VM functions to directly call shared libraries built in C/C++/Rust. Additionally, VM functions can be also passed to shared libraries as callback functions (enabling shared libraries to call back into the VM). This feature allows <em>XiaoXuan Core</em> to take full advantage of the rich ecosystem of existing shared libraries.</li>
<li><strong>Data-race-free parallelism model:</strong> The <em>XiaoXuan Core VM</em> has no &ldquo;global data&rdquo;, and threads are only allowed to communicate by passing copies of data through <em>channels</em>. This prevent data races and ensures thread safety.</li>
<li><strong>Embeddable in Rust applications:</strong> <em>XiaoXuan Core</em> programs and the VM can be embedded as a library in Rust applications. Rust can then call VM functions just like regular functions (using a JIT generated &ldquo;bridge function&rdquo;).</li>
</ul>
<h2 id="how-xiaoxuan-core-solves-verison-compatibility-issues">How XiaoXuan Core solves verison compatibility issues?</h2>
<p><em>XiaoXiao Core</em> applications can maintain correct operation even when the runtime environment changes (e.g., major version changes to the shared libraries in the system). This is achieved through the following two measures:</p>
<figure class="wide white"><img src="./images/version-model.png"
         alt="The XiaoXuan Core Applications Version Control"/><figcaption>
            <p>The XiaoXuan Core Applications Version Control</p>
        </figcaption>
</figure>

<ol>
<li>Runtime version specification</li>
</ol>
<p>Each <em>XiaoXuan Core</em> application is required to specify a runtime version number. For single-file applications, this is specified using the <code>config(runtime, &quot;1.0&quot;)</code> statement. For multi-file applications, it is specified in the package descriptor file <code>package.anon</code>, for example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;myapp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">runtime</span><span class="o">:</span> <span class="s2">&#34;1.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The <em>XiaoXuan Core Application Launcher</em> (<code>ancl</code>) will start the corresponding runtime based on the version number specified by the application to compile or run.</p>
<ol start="2">
<li>Bundled shared modules and shared libraries</li>
</ol>
<p>Each verson of the runtime comes with its own shared modules (e.g., <code>std</code> and <code>math</code>) and, most importantly, a set of dynamic shared libraries (e.g., <code>libc</code>, <code>libsqlite3</code>, <code>libz</code> etc.). This allows applications to not rely on the shared libraries of the OS.</p>
<p>Therefore, whether the <em>XiaoXuan Core</em> runtime is updated or the system shared library versions change, the application can run in the same environment as it was developed in.</p>
<p>This feature improves application compatibility and stability, reduces dependency on the system environment, simplifies application deployment and maintenance.</p>
<h2 id="get-started">Get started</h2>
<ul>
<li><span class="null-link">Get started with XiaoXuan Core in 5 minutes</span></li>
</ul>
<h2 id="manuals--tutorials">Manuals &amp; Tutorials</h2>


<ul class="card">
    <li>
        <div class="card-title">
            <h3><span class="null-link">The XiaoXuan Programming Language Reference</span></h3>
        </div>
        <div class="card-content">

<ul>
<li><span class="null-link">Data types</span></li>
<li><span class="null-link">Variables</span></li>
<li><span class="null-link">Functions</span></li>
<li><span class="null-link">Collection</span></li>
<li><span class="null-link">Control flow</span></li>
<li><span class="null-link">Method, generic and trait</span></li>
<li><span class="null-link">Pattern</span></li>
<li><span class="null-link">Chain</span></li>
<li><span class="null-link">Error handling</span></li>
<li><span class="null-link">Modules</span></li>
</ul>


        </div>
    </li>

    <li>
        <div class="card-title">
            <h3><span class="null-link">Build a simple OS from scratch (based on Linux kernel) using XiaoXuan Core</span></h3>
        </div>
        <div class="card-content">

<ul>
<li><span class="null-link">Set up a RISC-V virtual machine using QEMU</span></li>
<li><span class="null-link">Write a minimal `init` program</span></li>
<li><span class="null-link">Write a minimal `shell` program</span></li>
<li><span class="null-link">Fundamentals of file system and processes,  implementing the `pwd` and `ls` commands</span></li>
<li><span class="null-link">Implement the `mount` and `umount` commands</span></li>
<li><span class="null-link">Principals of `redirect`, implementing the `echo` and `cat` commands</span></li>
<li><span class="null-link">Principal of `pipe`, implementing the `tee` and `tr` commands</span></li>
<li><span class="null-link">Session and process groups</span></li>
<li><span class="null-link">The `root` privileges, users and groups, and the `setuid` bit</span></li>
<li><span class="null-link">Add support for shell scripts</span></li>
</ul>


        </div>
    </li>

    <li>
        <div class="card-title">
            <h3><span class="null-link">Build a Docker-like container utility from scratch using XiaoXuan Core</span></h3>
        </div>
        <div class="card-content">

<ul>
<li><span class="null-link">The principal of Linux container</span></li>
<li><span class="null-link">Isolating the file system</span></li>
<li><span class="null-link">Isolating the process space</span></li>
<li><span class="null-link">Isolating the accounts</span></li>
<li><span class="null-link">The virtual networking devices and route</span></li>
</ul>


        </div>
    </li>
</ul>

<h2 id="related-documents">Related documents</h2>
<h2 id="related-projects">Related projects</h2>
<p>The source code repositories of related projects:</p>
<ul>
<li><span class="null-link">XiaoXuan Core VM</span></li>
<li><span class="null-link">XiaoXuan Core Assembly</span></li>
<li><span class="null-link">XiaoXuan Core IR</span></li>
<li><span class="null-link">XiaoXuan Core Compiler</span></li>
<li><span class="null-link">XiaoXuan Core Runtime</span></li>
<li><span class="null-link">XiaoXuan Core Launcher</span></li>
<li><span class="null-link">XiaoXuan Allocator</span></li>
</ul>


</article>


<section class="post-nav">
    <ul>
        <li>
        
            <a href="https://hemashushu.github.io/works/xiaoxuan-local-hans/"><i class="fa fa-chevron-circle-left"></i> XiaoXuan Core - Chinese Edition (中文版)</a>
        
        </li>
        <li>
        
            <a href="https://hemashushu.github.io/works/xiaoyu-os/">XiaoYu OS <i class="fa fa-chevron-circle-right"></i> </a>
        
        </li>
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <ul>
            <li>
                <span>Copyright © 2023 - Hippospark Young | 
                    <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"><img alt="cc by-nc-nd" class="license" src="/images/cc-by-nc-nd.png" /></a> |
                    Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
                    Theme <a href="https://github.com/hemashushu/hugo-selina" title="Selina">Selina</a> |
                    <a href="https://hemashushu.github.io/index.xml">Subscribe </a></span>
            </li>
            
            
        </ul>
        
    </footer>
</div>
<script src="/js/scripts.js"></script>

  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J7X4YJHXM9"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-J7X4YJHXM9', { 'anonymize_ip': false });
}
</script>





</body>

</html>

